<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PGROUTING: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pgrouting-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PGROUTING
   &#160;<span id="projectnumber">2.6-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('Contraction.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="contents">
<div class="textblock"><h1><a class="anchor" id="contraction_intro"></a>
Introduction</h1>
<dl class="section note"><dt>Note</dt><dd>This documentation is focused on the developer of pgr_contraction. </dd>
<dd>
This documentation might include documentation used for the user. </dd>
<dd>
The developer should also read the documentation for the user.</dd></dl>
<p>Contracting a graph becomes a crucial operation when talking about big graphs like the graphs involved in routing across cities, countries, continents or the whole world.</p>
<p class="">The contraction level and contraction operations can become very complex, as the complexity of the graphs grows.</p>
<p class="">For this proposal, we are making our contraction algorithm simple as possible so that more contraction operations can be added in the future.</p>
<p class="">We are not aiming with this work to implement all the possible contraction operations but to give a framework such that adding a contraction operation can be easily achieved.</p>
<p class="">For this contraction implementation, there are two operations:</p>
<ol type="1">
<li>dead end contraction: vertices have one incoming edge</li>
<li>linear contraction: vertices have one incoming and one outgoing edge</li>
</ol>
<p class="">And with the additional characteristics:</p>
<ul>
<li>The user can forbid to contract a particular set of nodes or edges.</li>
<li>The user can decide how many times the cycle can be done.</li>
<li>If possible, the user can decide the order of the operations on a cycle.</li>
</ul>
<h2><a class="anchor" id="contraction_skeleton"></a>
The contraction skeleton</h2>
<p class="">In general we have an initial set up that may involve analizing the graph given as input and setting the non contractable nodes or edges. We have a cycle that will go and perform a contraction operation until while possible, and then move to the next contraction operation. Adding a new operation then becomes an "easy" task but more things might be involved, because the charachteristics of the graph change each time its contracted, so some interaction between contractions has to be implemented also.</p>
<h2>Procedure </h2>
<p class="">For contracting, we are going to cycle as follows</p>
<div class="fragment"><div class="line">input: G(V,E)</div><div class="line">removed_vertices = {}</div><div class="line"></div><div class="line"></div><div class="line">&lt;initial <span class="keyword">set</span> up&gt;</div><div class="line"><span class="keywordflow">do</span> N times {</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> ( &lt;conditions <span class="keywordflow">for</span> 1&gt; ) {</div><div class="line">        &lt; contraction operation 1 &gt;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> ( &lt;conditions <span class="keywordflow">for</span> 2&gt; ) {</div><div class="line">        &lt; contraction operation 2&gt;</div><div class="line">    }</div><div class="line">    .....</div><div class="line">}</div><div class="line"></div><div class="line">output: G<span class="stringliteral">&#39;(V&#39;</span>,E<span class="stringliteral">&#39;), removed_vertices</span></div></div><!-- fragment --><h2><a class="anchor" id="contraction_notation"></a>
Notation for this documentation</h2>
<ul>
<li>V: is the set of vertices</li>
<li>E: is the set of edges</li>
<li>G: is the graph</li>
<li>V1: is the set of <em>dead end</em> vertices</li>
<li>V2: is the set of <em>linear</em> vertices</li>
<li>removed_vertices: is the set of removed vertices</li>
</ul>
<p class="">The contracted graph will be represented with two parameters, the modified Graph, and the removed_vertices set.</p>
<div class="fragment"><div class="line">removed_vertices = {(v,1):{2}, (e,-1):{3}}.</div></div><!-- fragment --><p class="">The above notation indicates:</p><ul>
<li>Vertex 2 is removed, and belongs to vertex 1 subgraph</li>
<li>Vertex 3 is removed, and belongs to edge -1 subgraph</li>
</ul>
<h2><a class="anchor" id="contraction_dead_end"></a>
Dead End Contraction</h2>
<p class="">Characteristics:</p>
<ul>
<li>Contraction code: <b>1</b></li>
<li><code>V1</code>: set of vertices with 1 incoming edge in increasing order of id:</li>
<li>Edges with the same identifier are considered the same edge and if it has the <code>reverse_cost</code> valid the outgoing edge is ignored</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> ( V1 is not empty ) {</div><div class="line"></div><div class="line">    <span class="keyword">delete</span> <a class="code" href="structvertex.html">vertex</a> of V1</div><div class="line">    the deleted <a class="code" href="structvertex.html">vertex</a> add it to removed_vertices</div><div class="line">    <a class="code" href="structvertex.html">vertex</a> that leads to removed <a class="code" href="structvertex.html">vertex</a>, inherits the removed <a class="code" href="structvertex.html">vertex</a></div><div class="line"></div><div class="line">    &lt;adjust any conditions that might affect other contraction operation&gt;</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="contraction_linear"></a>
Linear Contraction</h2>
<p class="">Characteristics:</p>
<ul>
<li>Contraction code: <b>2</b></li>
<li><code>V2</code>: vertex with 1 incoming edge and 1 outgoing edge:</li>
<li>The outgoing edge must have different identifier of the incoming edge</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> ( V2 is not empty ) {</div><div class="line"></div><div class="line">    <span class="keyword">delete</span> <a class="code" href="structvertex.html">vertex</a> of V2</div><div class="line">    create <a class="code" href="structedge.html">edge</a> (shortcut)</div><div class="line">    the deleted <a class="code" href="structvertex.html">vertex</a> add it to removed_vertices</div><div class="line">    newly created <a class="code" href="structedge.html">edge</a>, inherits the removed <a class="code" href="structvertex.html">vertex</a></div><div class="line"></div><div class="line">    &lt;adjust any conditions that might affect other contraction operations&gt;</div><div class="line">    }</div></div><!-- fragment --><h1><a class="anchor" id="contraction_examples"></a>
Contraction examples</h1>
<h2><a class="anchor" id="contraction_examples_dead_end"></a>
Dead End Contraction</h2>
<ul>
<li>For simplicity all the edges in the examples have unit weight.</li>
<li>Perform dead end contraction</li>
<li>One cycle of contractions.</li>
</ul>
<p class="">Input:</p>
<div class="fragment"><div class="line">G = {E:{1(1, 2)}, V:{1, 2} }</div></div><!-- fragment --><p class="">Visually the graph is</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>(Rohith) practice a little graphviz :)</dd></dl>
<div class="image">
<img src="twoNodesoneEdge_a.png" alt="twoNodesoneEdge_a.png"/>
</div>
<div class="dotgraph">
<img src="dot_inline_dotgraph_1.png" alt="dot_inline_dotgraph_1.png" border="0" usemap="#dot_inline_dotgraph_1.map"/>
<map name="dot_inline_dotgraph_1.map" id="dot_inline_dotgraph_1.map"></map>
</div>
<h2>Initial set up: </h2>
<div class="fragment"><div class="line">removed_vertices={}</div><div class="line">V1 = {2}</div><div class="line">V2 = {}</div></div><!-- fragment --><h2>Procedure: </h2>
<div class="fragment"><div class="line">V1 = {2} is not empty</div><div class="line"></div><div class="line">    V1 = {}</div><div class="line">    V2 = {}</div><div class="line">    G = {V:{1}, E:{}}</div><div class="line">    removed_vertices = {(v, 1):{2}}.</div><div class="line"></div><div class="line">V1 is empty</div></div><!-- fragment --><h2>Results: </h2>
<div class="fragment"><div class="line">    G = {V:{1}, E:{}}</div><div class="line">    removed_vertices = {(v, 1):{2}}</div><div class="line">~~~~{.c}</div><div class="line"></div><div class="line">Visually the graph is</div><div class="line"></div><div class="line">@image html  ../doc/images/twoNodesoneEdge_b.png</div><div class="line"></div><div class="line"></div><div class="line">@subsection contraction_examples_linear Linear Contraction</div><div class="line"></div><div class="line">@subsection contraction_examples_linear_dead_end Linear and Dead End Contraction</div><div class="line"></div><div class="line">- For simplicity all the edges in the example have unit weight.</div><div class="line">- A weight different than 1 will be expressed explicitly.</div><div class="line">  Perform linear contraction operation followed by a dead end operation.</div><div class="line">  1 cycle of contraction.</div><div class="line"></div><div class="line"></div><div class="line">1. Input: G = {V:{1, 2, 3}, E:{(1, 2), (2, 3)}}</div><div class="line"></div><div class="line">Visually the graph is</div><div class="line">@image html  ../doc/images/threeNodestwoEdges_a.png</div><div class="line"></div><div class="line"></div><div class="line">2. initial <span class="keyword">set</span> up</div><div class="line">~~~~{.c}</div><div class="line">removed_vertices={}</div><div class="line">V1 = {3}</div><div class="line">V2 = {2}</div></div><!-- fragment --><ol type="1">
<li>Procedure <div class="fragment"><div class="line">V2 = {2} is not empty</div><div class="line"></div><div class="line">    V1 = {3}</div><div class="line">    removed_vertices = {(e, -1):{2}}</div><div class="line">    V2 = {}</div><div class="line">    G = {V:{1, 3}, E:{-1(1,3,c=2)}}</div><div class="line"></div><div class="line">V2 is empty</div></div><!-- fragment --></li>
</ol>
<p class="">Visually the graph is </p><div class="image">
<img src="threeNodestwoEdges_b.png" alt="threeNodestwoEdges_b.png"/>
</div>
<ol type="1">
<li>Since V2 is empty we go on to the next contraction operation <div class="fragment"><div class="line">V1 = {3} is not empty</div><div class="line"></div><div class="line">    V1 = {}</div><div class="line">    V2 = {}</div><div class="line">    removed_vertices = {(v, 1):{3, 2}}.</div><div class="line">    G = {V:{1}, E:{}}</div><div class="line"></div><div class="line">V1 is empty</div></div><!-- fragment --></li>
<li>Results <div class="fragment"><div class="line">removed_vertices = {(v, 1):{3, 2}}.</div><div class="line">G = {V:{1}, E:{}}</div></div><!-- fragment --></li>
</ol>
<p class="">Visually the graph is </p><div class="image">
<img src="threeNodestwoEdges_c.png" alt="threeNodestwoEdges_c.png"/>
</div>
<h2><a class="anchor" id="contraction_examples_Sample"></a>
Contraction of Sample Data</h2>
<ul>
<li>A weight different than 1 will be expressed explicitly. Perform dead end operation follwed with a linear operation. 1 cycle of contraction.</li>
</ul>
<ol type="1">
<li>initial set up <div class="fragment"><div class="line">G = { V:{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17},</div><div class="line">E:{ 1(1, 2),  2(2,3),     3(3,4),   4(2,5),</div><div class="line">    5(3,6),   6(7,8),     7(8,5),   8(5,6),</div><div class="line">    9(6,9),  10(5,10),   11(6,11), 12(10,11),</div><div class="line">   13(11,12), 14(10,13), 15(9,12), 16(4,9),</div><div class="line">   17(14,15), 18(16,17) }</div></div><!-- fragment --></li>
</ol>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000007">Todo:</a></b></dt><dd>(Rohith) add the id of each edge to the image</dd></dl>
<p class="">Visually the graph is </p><div class="image">
<img src="undirected_sampledata_a.png" alt="undirected_sampledata_a.png"/>
</div>
<ol type="1">
<li>Initial set up: <div class="fragment"><div class="line">removed_vertices={}</div><div class="line">V1 = {1,7,13,14,15,16,17}</div><div class="line">V2 = {4,8,12}</div></div><!-- fragment --></li>
<li>Dead end Contraction</li>
</ol>
<p class="">The dead end vertices can visually be seen in the next graph.</p><ul>
<li>The contraction is done in ascending order of the elements of V1</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000008">Todo:</a></b></dt><dd>(Rohith): add the id of each edge to the image, put a color to the dead end vertices</dd></dl>
<div class="image">
<img src="undirected_sampledata_a.png" alt="undirected_sampledata_a.png"/>
</div>
<div class="fragment"><div class="line">V1 = {1,7,13,14,15,16,17} <span class="comment">// is not empty</span></div><div class="line">    <span class="comment">// Contracting Vertex 1</span></div><div class="line">    V1 = {7,13,14,15,16,17}</div><div class="line">    V2 = {2,4,8,12}</div><div class="line">    G = {V:{2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17},</div><div class="line">    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 6(7,8), 7(8,5), 8(5,6), 9(6,9),</div><div class="line">        10(5,10), 11(6,11), 12(10,11), 13(11,12), 14(10,13), 15(9,12), 16(4,9), 17(14,15), 18(16,17)}}</div><div class="line">    removed_vertices = {(v, 2):{1}}.</div><div class="line"></div><div class="line"></div><div class="line">V1 = {7,13,14,15,16,17} <span class="comment">// is not empty</span></div><div class="line"></div><div class="line">    <span class="comment">// Contracting Vertex 7</span></div><div class="line">    V1 = {8,13,14,15,16,17}</div><div class="line">    V2 = {2,4,12}</div><div class="line">    G = {V:{2, 3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17},</div><div class="line">    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 7(8,5), 8(5,6), 9(6,9), 10(5,10),</div><div class="line">        11(6,11), 12(10,11), 13(11,12), 14(10,13), 15(9,12), 16(4,9), 17(14,15), 18(16,17)}}</div><div class="line">    removed_vertices = {(v, 2):{1}, (v,8):{7}}.</div><div class="line"></div><div class="line">V1 = {8,13,14,15,16,17} <span class="comment">// is not empty</span></div><div class="line"></div><div class="line">    <span class="comment">// Contracting Vertex 8</span></div><div class="line">    V1 = {13,14,15,16,17}</div><div class="line">    V2 = {2,4,12}</div><div class="line">    G = {V:{2, 3, 4, 5, 6, 9, 10, 11, 12, 13, 14, 15, 16, 17},</div><div class="line">    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 8(5,6), 9(6,9), 10(5,10),</div><div class="line">         11(6,11), 12(10,11), 13(11,12), 14(10,13), 15(9,12), 16(4,9), 17(14,15), 18(16,17)}}</div><div class="line">    removed_vertices = {(v, 2):{1}, (v,5):{8,7}}.</div><div class="line"></div><div class="line">V1 = {13,14,15,16,17} <span class="comment">// is not empty</span></div><div class="line"></div><div class="line">    <span class="comment">// Contracting Vertex 13</span></div><div class="line">    V1 = {14,15,16,17}</div><div class="line">    V2 = {2,4,10,12}</div><div class="line">    G = {V:{2, 3, 4, 5, 6, 9, 10, 11, 12, 14, 15, 16, 17},</div><div class="line">    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 8(5,6), 9(6,9), 10(5,10),</div><div class="line">         11(6,11), 12(10,11), 13(11,12), 15(9,12), 16(4,9), 17(14,15), 18(16,17)}}</div><div class="line">    removed_vertices = {(v, 2):{1}, (v,5):{8,7}, (v,10):{13}}.</div><div class="line"></div><div class="line">V1 = {14,15,16,17} <span class="comment">// is not empty</span></div><div class="line"></div><div class="line">    <span class="comment">// Contracting Vertex 14</span></div><div class="line">    V1 = {16,17} <span class="comment">// vertex 15 now is not a Dead End vertex</span></div><div class="line">    V2 = {2,4,10,12}</div><div class="line">    G = {V:{2, 3, 4, 5, 6, 9, 10, 11, 12, 15, 16, 17},</div><div class="line">    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 8(5,6), 9(6,9), 10(5,10),</div><div class="line">         11(6,11), 12(10,11), 13(11,12), 15(9,12), 16(4,9)}, 18(16,17)}</div><div class="line">    removed_vertices = {(v, 2):{1}, (v,5):{8,7}, (v,10):{13}, (v,15):{14}}.</div><div class="line"></div><div class="line">V1 = {16,17} <span class="comment">// is not empty</span></div><div class="line"></div><div class="line">    <span class="comment">// Contracting Vertex 14</span></div><div class="line">    V1 = {}  <span class="comment">// vertex 17 now is not a Dead End vertex</span></div><div class="line">    V2 = {2,4,10,12}</div><div class="line">    G = {V:{2, 3, 4, 5, 6, 9, 10, 11, 12, 15, 17},</div><div class="line">    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 8(5,6), 9(6,9), 10(5,10),</div><div class="line">         11(6,11), 12(10,11), 13(11,12), 15(9,12), 16(4,9)}}</div><div class="line">    removed_vertices = {(v, 2):{1}, (v,5):{8,7}, (v,10):{13}, (v,15):{14}, (v,17):{16}}.</div></div><!-- fragment --><p class="">3- Since V1 is empty, linear contraction is performed</p>
<p class="">The linear vertices can visually be seen in the next graph.</p><ul>
<li>The contraction is done in ascending order of the elements of V2</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>(Rohith) add the id of each edge to the image, put a color to the linear vertices</dd></dl>
<div class="image">
<img src="undirected_sampledata_b.png" alt="undirected_sampledata_b.png"/>
</div>
<div class="fragment"><div class="line">V2 = {2,4,10,12} <span class="comment">// is not empty</span></div><div class="line"></div><div class="line">    <span class="comment">// Contracting Vertex 2</span></div><div class="line">    V1 = {}</div><div class="line">    V2 = {4,10,12}</div><div class="line">    G = {V:{3, 4, 5, 6, 9, 10, 11, 12, 15, 17},</div><div class="line">    E:{-1(3,5), 3(3,4), 5(3,6), 8(5,6), 9(6,9), 10(5,10),</div><div class="line">         11(6,11), 12(10,11), 13(11,12), 15(9,12), 16(4,9)}}</div><div class="line">    removed_vertices = {(e, -1):{1,2}, (v, 2):{1}, (v,5):{8,7}, (v,10):{13}, (v,15):{14}, (v,17):{16}}.</div><div class="line"></div><div class="line">V2 = {4,10,12} <span class="comment">// is not empty</span></div><div class="line"></div><div class="line">    <span class="comment">// Contracting Vertex 4</span></div><div class="line">    V1 = {}</div><div class="line">    V2 = {10,12}</div><div class="line">    G = {V:{3, 5, 6, 9, 10, 11, 12, 15, 17},</div><div class="line">    E:{-1(3,5),-2(3,9), 5(3,6), 8(5,6), 9(6,9), 10(5,10),</div><div class="line">         11(6,11), 12(10,11), 13(11,12), 15(9,12)}}</div><div class="line">    removed_vertices = {(e, -1):{1,2}, (e, -2):{4}, (v, 2):{1}, (v,5):{8,7}, (v,10):{13}, (v,15):{14}, (v,17):{16}}.</div><div class="line"></div><div class="line">V2 = {10,12} <span class="comment">// is not empty</span></div><div class="line"></div><div class="line">    <span class="comment">// Contracting Vertex 10</span></div><div class="line">    V1 = {}</div><div class="line">    V2 = {12}</div><div class="line">    G = {V:{3, 5, 6, 9, 11, 12, 15, 17},</div><div class="line">    E:{-1(3,5),-2(3,9), -3(5,11), 5(3,6), 8(5,6), 9(6,9),</div><div class="line">         11(6,11), 13(11,12), 15(9,12)}}</div><div class="line">    removed_vertices = {(e, -1):{1,2}, (e, -2):{4}, (e,-3):{10,13}, (v, 2):{1}, (v,5):{8,7}, (v,15):{14}, (v,17):{16}}.</div><div class="line"></div><div class="line">V2 = {12} <span class="comment">// is not empty</span></div><div class="line"></div><div class="line">    <span class="comment">// Contracting Vertex 12</span></div><div class="line">    V1 = {}</div><div class="line">    V2 = {}</div><div class="line">    G = {V:{3, 5, 6, 9, 11, 15, 17},</div><div class="line">    E:{-1(3,5),-2(3,9), -3(5,11), -4(9,11), 5(3,6), 8(5,6), 9(6,9), 11(6,11)}}</div><div class="line">    removed_vertices = {(e, -1):{1,2}, (e, -2):{4}, (e,-3):{10,13}, (e, -4):{12},</div><div class="line">         (v, 2):{1}, (v,5):{8,7}, (v,15):{14}, (v,17):{16}}.</div></div><!-- fragment --><ol type="1">
<li>Results: <div class="fragment"><div class="line">G = {V:{3, 5, 6, 9, 11, 15, 17},</div><div class="line">E:{-1(3,5),-2(3,9), -3(5,11), -4(9,11), 5(3,6), 8(5,6), 9(6,9), 11(6,11)}}</div><div class="line">removed_vertices = {(e, -1):{1,2}, (e, -2):{4}, (e,-3):{10,13}, (e, -4):{12},</div><div class="line">     (v, 2):{1}, (v,5):{8,7}, (v,15):{14}, (v,17):{16}}.</div></div><!-- fragment --> Visually the graph is <div class="image">
<img src="undirected_sampledata_b.png" alt="undirected_sampledata_b.png"/>
</div>
</li>
</ol>
<h1><a class="anchor" id="contraction_examples_Detailed"></a>
Generating the contracted graph</h1>
<p class="">Original Data:</p>
<p class="">.. literalinclude:: doc-contraction.queries :start-after: &ndash; q1 :end-before: &ndash; q2</p>
<p class="">:Addition of new columns:</p>
<p class="">.. code-block:: sql</p>
<div class="fragment"><div class="line">ALTER TABLE edge_table ADD is_contracted BOOLEAN DEFAULT <span class="keyword">false</span></div><div class="line">ALTER TABLE edge_table ADD contracted_vertices BIGINT[]</div></div><!-- fragment --><p class="">Data After Adding Columns:</p>
<div class="fragment"><div class="line">.. literalinclude:: doc-contraction.queries</div><div class="line">   :start-after: -- q4</div><div class="line">   :end-before: -- q5</div></div><!-- fragment --><p class="">Addition of new edges by the algorithm:</p>
<p class="">.. code-block:: sql</p>
<div class="fragment"><div class="line">INSERT INTO edge_table(<span class="keywordtype">id</span>, source, target, cost, reverse_cost, is_contracted, contracted_vertices) VALUES (-1, 3, 5, 2, 2, <span class="keyword">true</span>, ARRAY[1, 2])</div><div class="line">INSERT INTO edge_table(<span class="keywordtype">id</span>, source, target, cost, reverse_cost, is_contracted, contracted_vertices) VALUES (-2, 3, 9, 2, 2, true, ARRAY[4])</div><div class="line">INSERT INTO edge_table(<span class="keywordtype">id</span>, source, target, cost, reverse_cost, is_contracted, contracted_vertices) VALUES (-3, 5, 11, 2, 2, true, ARRAY[10, 13])</div><div class="line">INSERT INTO edge_table(<span class="keywordtype">id</span>, source, target, cost, reverse_cost, is_contracted, contracted_vertices) VALUES (-4, 9, 11, 2, 2, true, ARRAY[12])</div></div><!-- fragment --><p class="">Data after addition of new edges:</p>
<p class="">.. literalinclude:: doc-contraction.queries :start-after: &ndash; q9 :end-before: &ndash; q10</p>
<p class="">Contracted Graph Data:</p>
<p class="">.. literalinclude:: doc-contraction.queries :start-after: &ndash; q10 :end-before: &ndash; q11</p>
<h1><a class="anchor" id="contraction_examples_dijkstra"></a>
Dijkstra on contracted graph</h1>
<p class="">There are five cases which arise when calculating the shortest path between a given source and target,</p>
<p class="">Case 1**: Both source and target belong to the contracted graph.</p>
<p class="">Case 2**: Source belongs to a contracted graph, while target belongs to a vertex subgraph.</p>
<p class="">Case 3**: Source belongs to a contracted graph, while target belongs to an edge subgraph.</p>
<p class="">Case 4**: Source belongs to a vertex subgraph, while target belongs to an edge subgraph.</p>
<p class="">Case 5**: The path contains a new edge added by the contraction algorithm.</p>
<h2><a class="anchor" id="contraction_examples_dijkstra1"></a>
source and target belong to the contracted graph</h2>
<p class="">Routing from 3 to 11. Since 3 and 11 both are in the contracted graph it is not necessary expand the graph.</p>
<p class="">.. literalinclude:: doc-contraction.queries :start-after: &ndash; q11 :end-before: &ndash; q12</p>
<h2><a class="anchor" id="contraction_examples_dijkstra2"></a>
Source belongs to a contracted graph, while target belongs to a vertex subgraph.</h2>
<p class="">Routing from 3 to 7. Since 7 is in the contracted subgraph of vertex 5, it is necessary to expand that vertex by adding {7, 8} to the vertex set, so the vertex set becomes {3, 5, 6, 9, 11, 15, 17 , 7, 8}</p>
<p class="">.. literalinclude:: doc-contraction.queries :start-after: &ndash; q12 :end-before: &ndash; q13</p>
<h2><a class="anchor" id="contraction_examples_dijkstra3"></a>
Source belongs to a contracted graph, while target belongs to an edge subgraph.</h2>
<p class="">Routing from 3 to 13. Since 13 is in the contracted subgraph of edge (5, 11), it is necessary to expand that edge by adding {10, 13} to the vertex set, so the vertex set becomes {3, 5, 6, 9, 10, 11, 13, 15, 17}.</p>
<p class="">.. literalinclude:: doc-contraction.queries :start-after: &ndash; q13 :end-before: &ndash; q14</p>
<h2><a class="anchor" id="contraction_examples_dijkstra4"></a>
Source belongs to a vertex subgraph, while target belongs to an edge subgraph.</h2>
<p class="">Routing from 7 to 13.i</p><ul>
<li>Since 13 is in the contracted subgraph of edge (5, 11), it is necessary to expand that edge by adding {10, 13} to the vertex set,</li>
<li>and since 7 is in the contracted subgraph of vertex 5, it is necessary to expand that vertex by adding {7, 8} vertex set,</li>
<li>so the vertex set becomes {3, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17}</li>
</ul>
<p class="">.. literalinclude:: doc-contraction.queries :start-after: &ndash; q14 :end-before: &ndash; q15</p>
<h2><a class="anchor" id="contraction_examples_dijkstra5"></a>
The path contains a new edge added by the contraction algorithm.</h2>
<p class="">Routing from 3 to 9. Since 3 and 9 both are in the contracted graph it is not necessary expand the graph.</p>
<p class="">.. literalinclude:: doc-contraction.queries :start-after: &ndash; q15 :end-before: &ndash; q16</p>
<p class="">.. literalinclude:: doc-contraction.queries :start-after: &ndash; q16 :end-before: &ndash; q17</p>
<ul>
<li>This implies that it is a shortcut and should be expanded.</li>
<li>The contracted subgraph of edge 20(3, 9, c=2) is {4}.</li>
<li>It is necessary to expand the edge by adding {4} to the vertex set,</li>
<li>so the vertex set becomes {3, 4, 5, 6, 9, 11, 15, 17}.</li>
</ul>
<p class="">.. literalinclude:: doc-contraction.queries :start-after: &ndash; q17 :end-before: &ndash; q18</p>
<h1><a class="anchor" id="contraction_examples_references"></a>
References</h1>
<p class=""><a href="http://www.cs.cmu.edu/afs/cs/academic/class/15210-f12/www/lectures/lecture16.pdf">http://www.cs.cmu.edu/afs/cs/academic/class/15210-f12/www/lectures/lecture16.pdf</a></p>
<p class=""><a href="http://algo2.iti.kit.edu/documents/routeplanning/geisberger_dipl.pdf">http://algo2.iti.kit.edu/documents/routeplanning/geisberger_dipl.pdf</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Jan 26 2018 01:57:45 for PGROUTING by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
